"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const THREE = __importStar(require("@mxw/three"));
const maxwhere_1 = require("maxwhere");
const three_utils_1 = __importDefault(require("@mxw/three-utils"));
const lodash_1 = __importDefault(require("lodash"));
// Unity Transform class and Three.js Object3D inspired MaxWhere Transform class.
// Unity Transform: https://docs.unity3d.com/ScriptReference/Transform.html
// Three.js Object3D https://threejs.org/docs/#api/en/core/Object3D.matrix
class Transform {
    constructor(node, forwardIdentity, upIdentity, rightIdentity) {
        this.node = node;
        this.forwardIdentity =
            (forwardIdentity === null || forwardIdentity === void 0 ? void 0 : forwardIdentity.normalize()) || new THREE.Vector3(0, 0, 1);
        this.upIdentity = (upIdentity === null || upIdentity === void 0 ? void 0 : upIdentity.normalize()) || new THREE.Vector3(0, 1, 0);
        this.rightIdentity =
            (rightIdentity === null || rightIdentity === void 0 ? void 0 : rightIdentity.normalize()) || new THREE.Vector3(1, 0, 0);
    }
    /**
     * World position of object
     */
    get position() {
        return three_utils_1.default.V3ToThree(this.node.getPosition());
    }
    set position(value) {
        this.node.setPosition(three_utils_1.default.V3ToMw(value), 'absolute', 'world');
    }
    /**
     * Local position of object
     */
    get localPosition() {
        return three_utils_1.default.V3ToThree(this.node.getPosition({ local: true }));
    }
    set localPosition(value) {
        this.node.setPosition(three_utils_1.default.V3ToMw(value));
    }
    /**
     * World rotation in quaternion.
     */
    get rotation() {
        return three_utils_1.default.QuatToThree(this.node.getOrientation());
    }
    set rotation(value) {
        this.node.setOrientation(three_utils_1.default.QuatToMw(value.normalize()), 'absolute', 'world');
    }
    /**
     * Local rotation in quaternion
     */
    get localRotation() {
        return three_utils_1.default.QuatToThree(this.node.getOrientation({ local: true }));
    }
    set localRotation(value) {
        this.node.setOrientation(three_utils_1.default.QuatToMw(value.normalize()));
    }
    /**
     * World scale
     */
    get scale() {
        return three_utils_1.default.V3ToThree(this.node.getScale());
    }
    set scale(value) {
        this.node.setScale(three_utils_1.default.V3ToMw(value), 'absolute', 'world');
    }
    /**
     * Local scale
     */
    get localScale() {
        return three_utils_1.default.V3ToThree(this.node.getScale({ local: true }));
    }
    set localScale(value) {
        this.node.setScale(three_utils_1.default.V3ToMw(value));
    }
    /**
     * World matrix
     */
    get matrix() {
        return new THREE.Matrix4().compose(this.position, this.rotation, this.scale);
    }
    /**
     * Local matrix
     */
    get localMatrix() {
        return new THREE.Matrix4().compose(this.localPosition, this.localRotation, this.localScale);
    }
    /**
     * Returns a normalized vector representing the blue axis of the transform in world space.
     */
    get forward() {
        return new THREE.Vector3()
            .copy(this.forwardIdentity)
            .applyQuaternion(three_utils_1.default.QuatToThree(this.node.getOrientation()));
    }
    set forward(value) {
        //TODO
        //maybe up vector is needed
        this.node.setOrientation(three_utils_1.default.QuatToMw(new THREE.Quaternion().setFromUnitVectors(this.forwardIdentity, value)));
    }
    /**
     * The green axis of the transform in world space.
     */
    get up() {
        return new THREE.Vector3()
            .copy(this.upIdentity)
            .applyQuaternion(three_utils_1.default.QuatToThree(this.node.getOrientation()));
    }
    set up(value) {
        //maybe forward vector is needed
        this.node.setOrientation(three_utils_1.default.QuatToMw(new THREE.Quaternion().setFromUnitVectors(this.upIdentity, value)));
    }
    /**
     * The red axis of the transform in world space.
     */
    get right() {
        return new THREE.Vector3()
            .copy(this.rightIdentity)
            .applyQuaternion(three_utils_1.default.QuatToThree(this.node.getOrientation()));
    }
    set right(value) {
        //maybe forward vector is needed
        this.node.setOrientation(three_utils_1.default.QuatToMw(new THREE.Quaternion().setFromUnitVectors(this.rightIdentity, value)));
    }
    /**
     * The rotation as Euler angles in radians.
     */
    get eulerAngles() {
        return new THREE.Euler().setFromQuaternion(three_utils_1.default.QuatToThree(this.node.getOrientation()), 'ZXY');
    }
    set eulerAngles(value) {
        let quat = three_utils_1.default.QuatToMw(new THREE.Quaternion().setFromEuler(value));
        this.node.setOrientation(quat, 'absolute', 'world');
    }
    /**
     * The rotation as Euler angles in degrees.
     */
    get eulerAnglesInDegrees() {
        let euler = new THREE.Euler().setFromQuaternion(three_utils_1.default.QuatToThree(this.node.getOrientation()), 'ZXY');
        return {
            x: euler.x * THREE.MathUtils.RAD2DEG,
            y: euler.y * THREE.MathUtils.RAD2DEG,
            z: euler.z * THREE.MathUtils.RAD2DEG,
        };
    }
    /**
     * The rotation as Euler angles in radians relative to the parent transform's rotation.
     */
    get localEulerAngles() {
        return new THREE.Euler().setFromQuaternion(three_utils_1.default.QuatToThree(this.node.getOrientation({ local: true })), 'ZXY');
    }
    set localEulerAngles(value) {
        let quat = three_utils_1.default.QuatToMw(new THREE.Quaternion().setFromEuler(value));
        this.node.setOrientation(quat);
    }
    /**
     * The rotation as Euler angles in degrees relative to the parent transform's rotation.
     */
    get localEulerAnglesInDegrees() {
        let euler = new THREE.Euler().setFromQuaternion(three_utils_1.default.QuatToThree(this.node.getOrientation({ local: true })), 'ZXY');
        return {
            x: euler.x * THREE.MathUtils.RAD2DEG,
            y: euler.y * THREE.MathUtils.RAD2DEG,
            z: euler.z * THREE.MathUtils.RAD2DEG,
        };
    }
    /**
     * Return children transforms
     * Warning! Forward, up and right vectors will be default and might give incorrect result.
     */
    get children() {
        return this.node.children.map((child) => new Transform(child));
    }
    /**
     * Converts the vector from this object's local space to world space.
     *
     * @param pos A vector representing a position in this object's local space.
     * @returns The new converted vector
     */
    localToWorld(pos) {
        return pos.clone().applyMatrix4(this.matrix);
    }
    /**
     * Converts the vector from world space to this object's local space.
     *
     * @param pos A vector representing a position in world space.
     * @returns The new converted vector
     */
    worldToLocal(pos) {
        return pos.clone().applyMatrix4(this.matrix.invert());
    }
    /**
     * Converts the vector from this object's local space to another local space.
     *
     * @param pos A vector representing a position in this object's local space.
     * @param transform The other object which local space we want to use.
     * @returns The new converted vector
     */
    localToLocal(pos, transform) {
        return transform.worldToLocal(this.localToWorld(pos));
    }
    /**
     * Rotates the transform so the forward vector points at /target/'s current positions's X and Z cooridinates.
     * @param pos position too look at
     */
    lookAtXZ(pos) {
        let posXZ = pos.clone();
        posXZ.setY(this.position.y);
        this.lookAt(posXZ);
    }
    /**
     * Rotates the transform so the forward vector points at /target/'s current position.
     * @param pos position too look at
     */
    lookAt(pos) {
        let rotationMatrix = new THREE.Matrix4().lookAt(this.position, pos, this.upIdentity);
        this.node.setOrientation(three_utils_1.default.QuatToMw(new THREE.Quaternion()
            .setFromRotationMatrix(rotationMatrix)
            .multiply(new THREE.Quaternion().setFromUnitVectors(new THREE.Vector3(0, 0, -1), this.forwardIdentity))), 'absolute', 'world');
    }
    /**
     * Look at position and animate it.
     * @param pos position to look at
     * @param duration duration in sec
     * @param overrideCurrentPos overrides this.position during calculation
     */
    async lookAtAnimate(pos, duration, overrideCurrentPos) {
        let rotationMatrix;
        if (overrideCurrentPos) {
            rotationMatrix = new THREE.Matrix4().lookAt(overrideCurrentPos, pos, this.upIdentity);
        }
        else {
            rotationMatrix = new THREE.Matrix4().lookAt(this.position, pos, this.upIdentity);
        }
        await this.animate('orientation', {
            to: three_utils_1.default.QuatToMw(new THREE.Quaternion()
                .setFromRotationMatrix(rotationMatrix)
                .multiply(new THREE.Quaternion().setFromUnitVectors(new THREE.Vector3(0, 0, -1), this.forwardIdentity))),
            duration: duration,
        });
    }
    /**
     * Look at direction.
     * @param dir Direction vector.
     */
    lookAtDir(dir) {
        let rotationMatrix = new THREE.Matrix4().lookAt(dir, new THREE.Vector3(0, 0, 0), this.upIdentity);
        this.node.setOrientation(three_utils_1.default.QuatToMw(new THREE.Quaternion()
            .setFromRotationMatrix(rotationMatrix)
            .multiply(new THREE.Quaternion().setFromUnitVectors(new THREE.Vector3(0, 0, -1), this.forwardIdentity))));
    }
    /**
     * Promise wrapper for Maxwhere Node.animate
     * Animates the Node by changing the specified attribute of its transformation. Animation will change the attribute according to the specified option parameters step by step.
     *
     * @param attribute Transformation type. Possible values are position, scale, orientation. Matching values are Object {x, y, z} for position, scale and Object {w, x, y, z} or {angle, axis} for orientation
     * @param options Options determining the run of the animation.
     * @param complete Callback for completed animation. If repeat is true the animation will be completed only if stopped manually.
     * @returns Promise which resolves when animation is completed
     */
    animate(attribute, options, complete) {
        return new Promise((resolve) => {
            //@ts-ignore
            this.node.animate(attribute, options, () => {
                if (complete) {
                    complete();
                }
                resolve(this.node);
            });
        });
    }
    /**
     * Look at this with maxwhere camera.
     * @param duration animation duration in sec
     * @param offset position offset for camera compared to this.position. If offset is an array the closest position to the current camera position will be chosen.
     */
    async lookAtThisWithCamera(duration, offset) {
        let cameraTargetPosition;
        let camera = new Transform(maxwhere_1.wom.camera, new THREE.Vector3(0, 0, -1));
        if (lodash_1.default.isArray(offset)) {
            let minDistance = Infinity;
            for (let index = 0; index < offset.length; index++) {
                let posCandidate = this.position.add(offset[index]);
                let distance = posCandidate.distanceTo(camera.position);
                if (distance < minDistance) {
                    minDistance = distance;
                    cameraTargetPosition = posCandidate;
                }
            }
        }
        else {
            cameraTargetPosition = this.position.add(offset);
        }
        await Promise.all([
            camera.animate('position', {
                to: three_utils_1.default.V3ToMw(cameraTargetPosition),
                duration: duration,
            }),
            camera.lookAtAnimate(this.position, duration / 2, cameraTargetPosition),
        ]);
    }
    /**
     * Rotate an object along an axis in object space. The axis is assumed to be normalized.
     * @param axis A normalized vector in object space.
     * @param angle The angle in degrees.
     * @returns
     */
    rotateOnAxis(axis, angle) {
        // rotate object on axis in object space
        // axis is assumed to be normalized
        let offsetRotation = new THREE.Quaternion().setFromAxisAngle(axis, angle * THREE.MathUtils.DEG2RAD);
        this.localRotation = this.localRotation.multiply(offsetRotation);
        return this;
    }
    /**
     *  Rotate an object along an axis in world space. The axis is assumed to be normalized.
     * @param axis A normalized vector in object space.
     * @param angle The angle in degrees.
     * @returns
     */
    rotateOnWorldAxis(axis, angle) {
        // rotate object on axis in world space
        // axis is assumed to be normalized
        let offsetRotation = new THREE.Quaternion().setFromAxisAngle(axis, angle * THREE.MathUtils.DEG2RAD);
        this.rotation = this.rotation.multiply(offsetRotation);
        return this;
    }
}
exports.default = Transform;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHJhbnNmb3JtLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3dyYXBwZXJzL1RyYW5zZm9ybS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsa0RBQW9DO0FBQ3BDLHVDQVVrQjtBQUNsQixtRUFBa0M7QUFDbEMsb0RBQXVCO0FBRXZCLGlGQUFpRjtBQUNqRiwyRUFBMkU7QUFDM0UsMEVBQTBFO0FBRTFFLE1BQXFCLFNBQVM7SUFLNUIsWUFDRSxJQUFVLEVBQ1YsZUFBK0IsRUFDL0IsVUFBMEIsRUFDMUIsYUFBNkI7UUFFN0IsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLGVBQWU7WUFDbEIsQ0FBQSxlQUFlLGFBQWYsZUFBZSx1QkFBZixlQUFlLENBQUUsU0FBUyxFQUFFLEtBQUksSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDN0QsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFBLFVBQVUsYUFBVixVQUFVLHVCQUFWLFVBQVUsQ0FBRSxTQUFTLEVBQUUsS0FBSSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN4RSxJQUFJLENBQUMsYUFBYTtZQUNoQixDQUFBLGFBQWEsYUFBYixhQUFhLHVCQUFiLGFBQWEsQ0FBRSxTQUFTLEVBQUUsS0FBSSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUM3RCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFJLFFBQVE7UUFDVixPQUFPLHFCQUFFLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQztJQUMvQyxDQUFDO0lBQ0QsSUFBSSxRQUFRLENBQUMsS0FBb0I7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