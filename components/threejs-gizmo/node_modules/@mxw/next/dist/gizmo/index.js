"use strict";
/* Copyright (C) 2015-2019 MISTEMS Ltd. - All Rights Reserved
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const maxwhere_1 = require("maxwhere");
const womAsync_module_1 = __importDefault(require("../wrappers/womAsync.module"));
const utils = __importStar(require("../utils/index"));
const electron_1 = require("electron");
const path_1 = __importDefault(require("path"));
class Gizmo {
    constructor(options) {
        this.spatialGizmo = false;
        this.isGizmoActive = false;
        this.targetTranslate = (event, pos) => {
            var _a;
            (_a = this.target) === null || _a === void 0 ? void 0 : _a.setPosition(pos.x, pos.y, pos.z, 'absolute', 'world');
        };
        this.targetRotate = (event, ori) => {
            var _a;
            (_a = this.target) === null || _a === void 0 ? void 0 : _a.setOrientation(ori.w, ori.x, ori.y, ori.z, 'absolute', 'world');
        };
        this.targetScale = (event, scale) => {
            var _a;
            (_a = this.target) === null || _a === void 0 ? void 0 : _a.setScale(scale.x, scale.y, scale.z);
        };
        this.addOverlay = (options) => {
            let overlay = maxwhere_1.wom.create('overlay', {
                id: 'gizmo-overlay',
                width: maxwhere_1.wom.appConfig.width,
                height: maxwhere_1.wom.appConfig.height,
                'resolution-width': maxwhere_1.wom.appConfig.width,
                'resolution-height': maxwhere_1.wom.appConfig.height,
                scaleFactor: 1,
                // accept mouse events to make it orbit-able
                physical: { raycast: true },
                // URL to load
                url: path_1.default.join(__dirname, '../../', 'controller-window', 'index.html'),
                // accept input events when hovered
                inputDisabled: false,
                nodeIntegration: true,
                transparent: true,
                directKeyEvent: false,
                zorder: 40,
                done: (o) => {
                    //o.hide();
                    this.setActiveAreaToZero();
                    if (this.options.mode == 'editor') {
                        // ipcMain.on('gizmo_toggle_rq', (event, value) => {
                        //   if (value) {
                        //     this.showOverlay();
                        //   } else {
                        //     this.hideOverlay();
                        //   }
                        // });
                    }
                    else {
                        //wom.on('contextMenu', this.showOverlayListener);
                        maxwhere_1.wom.on('click', this.detachTargetListener);
                    }
                    //o.browserWindow.webContents.openDevTools({ mode: 'detach' });
                },
            });
            overlay.once('ready', () => {
                if (options.siblingContentID) {
                    this.sendWebcontentID(options.siblingContentID);
                }
                electron_1.ipcMain.on('set-gizmo-active-areas', (event, activeArea) => {
                    overlay.setActiveAreas(activeArea);
                });
                overlay.browserWindow.webContents.send('set-active-area-sebug-state', this.options.activeAreaDebug);
                if (this.options.snap) {
                    overlay.browserWindow.webContents.send('set-snap', this.options.snap);
                }
                if (this.options.show) {
                    overlay.browserWindow.webContents.send('show-state', this.options.show);
                }
                else {
                    overlay.browserWindow.webContents.send('show-state', {
                        translate: { x: true, y: true, z: true },
                        rotate: { x: true, y: true, z: true },
                        scale: { x: true, y: true, z: true },
                    });
                }
                // send view props for camera init
                this.overlay.browserWindow.webContents.send('view-transfer', 
                //@ts-ignore
                this.getViewProps(maxwhere_1.wom.view));
            });
            maxwhere_1.wom.render(overlay);
            return overlay;
        };
        this.setActiveAreaToZero = async () => {
            await utils.sleep(2000);
            this.overlay.setActiveAreas([{ x: 0, y: 0, w: 0.001, h: 0.001 }]);
        };
        this.setStateChange = (event, state) => {
            if (state && maxwhere_1.wom.isSpatialControlEnabled()) {
                maxwhere_1.wom.setSpatialControl(false);
                this.spatialGizmo = true;
            }
            else if (this.spatialGizmo) {
                maxwhere_1.wom.setSpatialControl(true);
                this.spatialGizmo = false;
            }
            this.isGizmoActive = state;
        };
        this.sendWebcontentID = (webContentID) => {
            this.overlay.browserWindow.webContents.send('sibling-transfer', webContentID);
        };
        this.targetTranslateBackwardsHandler = () => {
            var _a;
            if (!this.isGizmoActive) {
                this.overlay.browserWindow.webContents.send('target-translate-backwards', (_a = this.target) === null || _a === void 0 ? void 0 : _a.getPosition());
            }
        };
        this.targetRotateBackwardsHandler = () => {
            var _a;
            if (!this.isGizmoActive) {
                this.overlay.browserWindow.webContents.send('target-rotate-backwards', (_a = this.target) === null || _a === void 0 ? void 0 : _a.getOrientation());
            }
        };
        this.targetScaleBackwardsHandler = () => {
            var _a;
            if (!this.isGizmoActive) {
                this.overlay.browserWindow.webContents.send('target-scale-backwards', (_a = this.target) === null || _a === void 0 ? void 0 : _a.getScale());
            }
        };
        this.attachTarget = (id) => {
            this.detachTarget();
            if (id) {
                let node = maxwhere_1.wom.select(`#${id}`);
                console.log(`attach gizmo target id: ${id}, url: ${node.url}`);
                this.target = node;
                this.overlay.browserWindow.webContents.send('target-transfer', this.getNodeProps(this.target));
                womAsync_module_1.default.selfAwareListener({ type: 'node-position', subject: this.target.node.GetName() }, this.targetTranslateBackwardsHandler, this.target);
                womAsync_module_1.default.selfAwareListener({ type: 'node-orientation', subject: this.target.node.GetName() }, this.targetRotateBackwardsHandler, this.target);
                womAsync_module_1.default.selfAwareListener({ type: 'node-scale', subject: this.target.node.GetName() }, this.targetScaleBackwardsHandler, this.target);
                womAsync_module_1.default.selfAwareListener({ type: 'node-delete', subject: this.target.node.GetName() }, () => {
                    this.detachTarget();
                }, this.target);
            }
            else {
                this.target = undefined;
            }
        };
        this.attachTargetListener = (event) => {
            if (event.ctrlKey) {
                if (event.target.includes('_physical') && event.is3d) {
                    let id = event.target.replace('_physical', '');
                    console.log(`attach target to gizmo: ${id}`);
                    this.attachTarget(id);
                }
            }
        };
        this.detachTargetListener = (event) => {
            if (this.target && !event.target) {
                this.detachTarget();
                this.setActiveAreaToZero();
            }
        };
        this.sendCameraOrientation = () => {
            this.overlay.browserWindow.webContents.send('camera-orientaion', maxwhere_1.wom.camera.getOrientation());
        };
        this.sendCameraPosition = () => {
            this.overlay.browserWindow.webContents.send('camera-position', maxwhere_1.wom.camera.getPosition());
        };
        this.cameraSync = () => {
            // sync the camera orientation
            maxwhere_1.wom.on({ type: 'node-orientation', subject: 'CogiNavOrbitHelper' }, () => {
                this.sendCameraOrientation();
                this.sendCameraPosition();
            });
            womAsync_module_1.default.selfAwareListener({ type: 'node-position', subject: 'CogiNavOrbitHelper' }, () => {
                this.sendCameraOrientation();
                this.sendCameraPosition();
            }, this.overlay);
            maxwhere_1.wom.on({ type: 'node-orientation', subject: maxwhere_1.wom.camera.node.GetName() }, this.sendCameraOrientation);
            //sync the camera position
            maxwhere_1.wom.on({ type: 'node-position', subject: maxwhere_1.wom.camera.node.GetName() }, this.sendCameraPosition);
        };
        this.options = options;
        this.overlay = this.addOverlay(options);
        this.cameraSync();
        this.targetSync();
        this.resizeSync();
        electron_1.ipcMain.on('gizmo-state', this.setStateChange);
        if (this.options.mode == 'editor') {
            electron_1.ipcMain.on('gizmo_target_rq', (event, id) => {
                this.attachTarget(id);
            });
        }
        else {
            maxwhere_1.wom.on('click', this.attachTargetListener);
        }
    }
    detachTarget() {
        if (this.target && this.target.node) {
            this.overlay.browserWindow.webContents.send('target-transfer', '');
            maxwhere_1.wom.removeListener({ type: 'node-position', subject: this.target.node.GetName() }, this.targetTranslateBackwardsHandler);
            maxwhere_1.wom.removeListener({ type: 'node-orientation', subject: this.target.node.GetName() }, this.targetRotateBackwardsHandler);
            maxwhere_1.wom.removeListener({ type: 'node-scale', subject: this.target.node.GetName() }, this.targetScaleBackwardsHandler);
            this.target = undefined;
        }
        else if (this.target) {
            this.overlay.browserWindow.webContents.send('target-transfer', '');
            this.target = undefined;
        }
    }
    clear() {
        maxwhere_1.wom.removeListener('click', this.detachTargetListener);
        maxwhere_1.wom.removeListener('dblclick', this.attachTargetListener);
        maxwhere_1.wom.removeListener({ type: 'node-orientation', subject: maxwhere_1.wom.camera.node.GetName() }, this.sendCameraOrientation);
        maxwhere_1.wom.removeListener({ type: 'node-position', subject: maxwhere_1.wom.camera.node.GetName() }, this.sendCameraPosition);
        maxwhere_1.wom.removeListener('contextMenu', this.attachTargetListener);
        //wom.removeListener('resize', this.resizeWindow);
        electron_1.ipcMain.removeListener('target-translate', this.targetTranslate);
        electron_1.ipcMain.removeListener('target-rotate', this.targetRotate);
        electron_1.ipcMain.removeListener('target-scale', this.targetScale);
        this.overlay.clear();
    }
    /**
     * Notify renderer process in case resized MaxWhere window
     */
    resizeSync() {
        // wom.on('resize', this.resizeWindow);
        maxwhere_1.wom.on('resize', ({ w, h }) => {
            this.overlay.setResolution(w, h);
            this.overlay.setSize(w, h);
            this.overlay.browserWindow.webContents.send('window-resolution-change', {
                w,
                h,
            });
        });
        maxwhere_1.wom.on('dpi-change', ({ dpi }) => {
            this.overlay.setPixelScaleFactor(dpi);
        });
    }
    /**
     * Register event listereners in case the  target in renderer process changes
     */
    targetSync() {
        electron_1.ipcMain.on('target-translate', this.targetTranslate);
        electron_1.ipcMain.on('target-rotate', this.targetRotate);
        electron_1.ipcMain.on('target-scale', this.targetScale);
    }
    getViewProps(view) {
        let viewProps = {
            FOV: view.GetFoV(),
            far: view.GetClipDistances().far,
            near: view.GetClipDistances().near,
        };
        return viewProps;
    }
    /**
     * Get node props
     * @param {Node} node
     * @returns Node props
     */
    getNodeProps(node) {
        let position = node.getPosition();
        let orientation = node.getOrientation();
        let scale = node.getScale();
        let nodeProps = {
            position: {
                x: position.x,
                y: position.y,
                z: position.z,
            },
            quaternion: {
                x: orientation.x,
                y: orientation.y,
                z: orientation.z,
                w: orientation.w,
            },
            scale: {
                x: scale.x,
                y: scale.y,
                z: scale.z,
            },
        };
        return nodeProps;
    }
    fovSync() { }
}
exports.default = Gizmo;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZ2l6bW8vaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVILHVDQVlrQjtBQUNsQixrRkFBbUQ7QUFDbkQsc0RBQXdDO0FBRXhDLHVDQUFtQztBQUNuQyxnREFBd0I7QUFFeEIsTUFBcUIsS0FBSztJQU14QixZQUFZLE9BQXFCO1FBSmpDLGlCQUFZLEdBQVksS0FBSyxDQUFDO1FBQzlCLGtCQUFhLEdBQVksS0FBSyxDQUFDO1FBdUIvQixvQkFBZSxHQUFHLENBQUMsS0FBNEIsRUFBRSxHQUFZLEVBQUUsRUFBRTs7WUFDL0QsTUFBQSxJQUFJLENBQUMsTUFBTSwwQ0FBRSxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEVBQUUsVUFBVSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ3JFLENBQUMsQ0FBQztRQUNGLGlCQUFZLEdBQUcsQ0FBQyxLQUE0QixFQUFFLEdBQWUsRUFBRSxFQUFFOztZQUMvRCxNQUFBLElBQUksQ0FBQyxNQUFNLDBDQUFFLGNBQWMsQ0FDekIsR0FBRyxDQUFDLENBQUMsRUFDTCxHQUFHLENBQUMsQ0FBQyxFQUNMLEdBQUcsQ0FBQyxDQUFDLEVBQ0wsR0FBRyxDQUFDLENBQUMsRUFDTCxVQUFVLEVBQ1YsT0FBTyxDQUNSLENBQUM7UUFDSixDQUFDLENBQUM7UUFDRixnQkFBVyxHQUFHLENBQUMsS0FBNEIsRUFBRSxLQUFjLEVBQUUsRUFBRTs7WUFDN0QsTUFBQSxJQUFJLENBQUMsTUFBTSwwQ0FBRSxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNuRCxDQUFDLENBQUM7UUFFRixlQUFVLEdBQUcsQ0FBQyxPQUFxQixFQUFFLEVBQUU7WUFDckMsSUFBSSxPQUFPLEdBQUcsY0FBRyxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUU7Z0JBQ2xDLEVBQUUsRUFBRSxlQUFlO2dCQUNuQixLQUFLLEVBQUUsY0FBRyxDQUFDLFNBQVMsQ0FBQyxLQUFLO2dCQUMxQixNQUFNLEVBQUUsY0FBRyxDQUFDLFNBQVMsQ0FBQyxNQUFNO2dCQUM1QixrQkFBa0IsRUFBRSxjQUFHLENBQUMsU0FBUyxDQUFDLEtBQUs7Z0JBQ3ZDLG1CQUFtQixFQUFFLGNBQUcsQ0FBQyxTQUFTLENBQUMsTUFBTTtnQkFDekMsV0FBVyxFQUFFLENBQUM7Z0JBQ2QsNENBQTRDO2dCQUM1QyxRQUFRLEVBQUUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFO2dCQUMzQixjQUFjO2dCQUNkLEdBQUcsRUFBRSxjQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxRQUFRLEVBQUUsbUJBQW1CLEVBQUUsWUFBWSxDQUFDO2dCQUN0RSxtQ0FBbUM7Z0JBQ25DLGFBQWEsRUFBRSxLQUFLO2dCQUNwQixlQUFlLEVBQUUsSUFBSTtnQkFDckIsV0FBVyxFQUFFLElBQUk7Z0JBQ2pCLGNBQWMsRUFBRSxLQUFLO2dCQUNyQixNQUFNLEVBQUUsRUFBRTtnQkFDVixJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRTtvQkFDVixXQUFXO29CQUNYLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO29CQUMzQixJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxJQUFJLFFBQVEsRUFBRTt3QkFDakMsb0RBQW9EO3dCQUNwRCxpQkFBaUI7d0JBQ2pCLDBCQUEwQjt3QkFDMUIsYUFBYTt3QkFDYiwwQkFBMEI7d0JBQzFCLE1BQU07d0JBQ04sTUFBTTtxQkFDUDt5QkFBTTt3QkFDTCxrREFBa0Q7d0JBQ2xELGNBQUcsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO3FCQUM1QztvQkFFRCwrREFBK0Q7Z0JBQ2pFLENBQUM7YUFDRixDQUFDLENBQUM7WUFFSCxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUU7Z0JBQ3pCLElBQUksT0FBTyxDQUFDLGdCQUFnQixFQUFFO29CQUM1QixJQUFJLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7aUJBQ2pEO2dCQUVELGtCQUFPLENBQUMsRUFBRSxDQUFDLHdCQUF3QixFQUFFLENBQUMsS0FBSyxFQUFFLFVBQVUsRUFBRSxFQUFFO29CQUN6RCxPQUFPLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO2dCQUNyQyxDQUFDLENBQUMsQ0FBQztnQkFFSCxPQUFPLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQ3BDLDZCQUE2QixFQUM3QixJQUFJLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FDN0IsQ0FBQztnQkFFRixJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFO29CQUNyQixPQUFPLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7aUJBQ3ZFO2dCQUVELElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUU7b0JBQ3JCLE9BQU8sQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztpQkFDekU7cUJBQU07b0JBQ0wsT0FBTyxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRTt3QkFDbkQsU0FBUyxFQUFFLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUU7d0JBQ3hDLE1BQU0sRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFO3dCQUNyQyxLQUFLLEVBQUUsRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRTtxQkFDckMsQ0FBQyxDQUFDO2lCQUNKO2dCQUVELGtDQUFrQztnQkFDbEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLElBQUksQ0FDekMsZUFBZTtnQkFDZixZQUFZO2dCQUNaLElBQUksQ0FBQyxZQUFZLENBQUMsY0FBRyxDQUFDLElBQUksQ0FBQyxDQUM1QixDQUFDO1lBQ0osQ0FBQyxDQUFDLENBQUM7WUFFSCxjQUFHLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3BCLE9BQU8sT0FBTyxDQUFDO1FBQ2pCLENBQUMsQ0FBQztRQUVGLHdCQUFtQixHQUFHLEtBQUssSUFBSSxFQUFFO1lBQy9CLE1BQU0sS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN4QixJQUFJLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNwRSxDQUFDLENBQUM7UUFFRixtQkFBYyxHQUFHLENBQUMsS0FBNEIsRUFBRSxLQUFjLEVBQUUsRUFBRTtZQUNoRSxJQUFJLEtBQUssSUFBSSxjQUFHLENBQUMsdUJBQXVCLEVBQUUsRUFBRTtnQkFDMUMsY0FBRyxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUM3QixJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQzthQUMxQjtpQkFBTSxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7Z0JBQzVCLGNBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDNUIsSUFBSSxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7YUFDM0I7WUFDRCxJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQztRQUM3QixDQUFDLENBQUM7UUFFRixxQkFBZ0IsR0FBRyxDQUFDLFlBQW9CLEVBQUUsRUFBRTtZQUMxQyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUN6QyxrQkFBa0IsRUFDbEIsWUFBWSxDQUNiLENBQUM7UUFDSixDQUFDLENBQUM7UUFFRixvQ0FBK0IsR0FBRyxHQUFHLEVBQUU7O1lBQ3JDLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFO2dCQUN2QixJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUN6Qyw0QkFBNEIsRUFDNUIsTUFBQSxJQUFJLENBQUMsTUFBTSwwQ0FBRSxXQUFXLEVBQUUsQ0FDM0IsQ0FBQzthQUNIO1FBQ0gsQ0FBQyxDQUFDO1FBRUYsaUNBQTRCLEdBQUcsR0FBRyxFQUFFOztZQUNsQyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRTtnQkFDdkIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLElBQUksQ0FDekMseUJBQXlCLEVBQ3pCLE1BQUEsSUFBSSxDQUFDLE1BQU0sMENBQUUsY0FBYyxFQUFFLENBQzlCLENBQUM7YUFDSDtRQUNILENBQUMsQ0FBQztRQUVGLGdDQUEyQixHQUFHLEdBQUcsRUFBRTs7WUFDakMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUU7Z0JBQ3ZCLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQ3pDLHdCQUF3QixFQUN4QixNQUFBLElBQUksQ0FBQyxNQUFNLDBDQUFFLFFBQVEsRUFBRSxDQUN4QixDQUFDO2FBQ0g7UUFDSCxDQUFDLENBQUM7UUFFRixpQkFBWSxHQUFHLENBQUMsRUFBVSxFQUFFLEVBQUU7WUFDNUIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3BCLElBQUksRUFBRSxFQUFFO2dCQUNOLElBQUksSUFBSSxHQUFHLGNBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBUyxDQUFDO2dCQUN4QyxPQUFPLENBQUMsR0FBRyxDQUFDLDJCQUEyQixFQUFFLFVBQVUsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7Z0JBQy9ELElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO2dCQUVuQixJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUN6QyxpQkFBaUIsRUFDakIsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQy9CLENBQUM7Z0JBRUYseUJBQVEsQ0FBQyxpQkFBaUIsQ0FDeEIsRUFBRSxJQUFJLEVBQUUsZUFBZSxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsRUFBRSxFQUM5RCxJQUFJLENBQUMsK0JBQStCLEVBQ3BDLElBQUksQ0FBQyxNQUFNLENBQ1osQ0FBQztnQkFDRix5QkFBUSxDQUFDLGlCQUFpQixDQUN4QixFQUFFLElBQUksRUFBRSxrQkFBa0IsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEVBQUUsRUFDakUsSUFBSSxDQUFDLDRCQUE0QixFQUNqQyxJQUFJLENBQUMsTUFBTSxDQUNaLENBQUM7Z0JBQ0YseUJBQVEsQ0FBQyxpQkFBaUIsQ0FDeEIsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsRUFBRSxFQUMzRCxJQUFJLENBQUMsMkJBQTJCLEVBQ2hDLElBQUksQ0FBQyxNQUFNLENBQ1osQ0FBQztnQkFFRix5QkFBUSxDQUFDLGlCQUFpQixDQUN4QixFQUFFLElBQUksRUFBRSxhQUFhLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxFQUFFLEVBQzVELEdBQUcsRUFBRTtvQkFDSCxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7Z0JBQ3RCLENBQUMsRUFDRCxJQUFJLENBQUMsTUFBTSxDQUNaLENBQUM7YUFDSDtpQkFBTTtnQkFDTCxJQUFJLENBQUMsTUFBTSxHQUFHLFNBQVMsQ0FBQzthQUN6QjtRQUNILENBQUMsQ0FBQztRQXlCRix5QkFBb0IsR0FBRyxDQUFDLEtBQTJCLEVBQUUsRUFBRTtZQUNyRCxJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUU7Z0JBQ2pCLElBQUksS0FBSyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksS0FBSyxDQUFDLElBQUksRUFBRTtvQkFDcEQsSUFBSSxFQUFFLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDO29CQUMvQyxPQUFPLENBQUMsR0FBRyxDQUFDLDJCQUEyQixFQUFFLEVBQUUsQ0FBQyxDQUFDO29CQUM3QyxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2lCQUN2QjthQUNGO1FBQ0gsQ0FBQyxDQUFDO1FBRUYseUJBQW9CLEdBQUcsQ0FBQyxLQUEyQixFQUFFLEVBQUU7WUFDckQsSUFBSSxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRTtnQkFDaEMsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO2dCQUNwQixJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQzthQUM1QjtRQUNILENBQUMsQ0FBQztRQUVGLDBCQUFxQixHQUFHLEdBQUcsRUFBRTtZQUMzQixJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUN6QyxtQkFBbUIsRUFDbkIsY0FBRyxDQUFDLE1BQU0sQ0FBQyxjQUFjLEVBQUUsQ0FDNUIsQ0FBQztRQUNKLENBQUMsQ0FBQztRQUNGLHVCQUFrQixHQUFHLEdBQUcsRUFBRTtZQUN4QixJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUN6QyxpQkFBaUIsRUFDakIsY0FBRyxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FDekIsQ0FBQztRQUNKLENBQUMsQ0FBQztRQUNGLGVBQVUsR0FBRyxHQUFHLEVBQUU7WUFDaEIsOEJBQThCO1lBQzlCLGNBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsa0JBQWtCLEVBQUUsT0FBTyxFQUFFLG9CQUFvQixFQUFFLEVBQUUsR0FBRyxFQUFFO2dCQUN2RSxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztnQkFDN0IsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7WUFDNUIsQ0FBQyxDQUFDLENBQUM7WUFFSCx5QkFBUSxDQUFDLGlCQUFpQixDQUN4QixFQUFFLElBQUksRUFBRSxlQUFlLEVBQUUsT0FBTyxFQUFFLG9CQUFvQixFQUFFLEVBQ3hELEdBQUcsRUFBRTtnQkFDSCxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztnQkFDN0IsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7WUFDNUIsQ0FBQyxFQUNELElBQUksQ0FBQyxPQUFPLENBQ2IsQ0FBQztZQUVGLGNBQUcsQ0FBQyxFQUFFLENBQ0osRUFBRSxJQUFJLEVBQUUsa0JBQWtCLEVBQUUsT0FBTyxFQUFFLGNBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxFQUFFLEVBQ2hFLElBQUksQ0FBQyxxQkFBcUIsQ0FDM0IsQ0FBQztZQUVGLDBCQUEwQjtZQUMxQixjQUFHLENBQUMsRUFBRSxDQUNKLEVBQUUsSUFBSSxFQUFFLGVBQWUsRUFBRSxPQUFPLEVBQUUsY0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEVBQUUsRUFDN0QsSUFBSSxDQUFDLGtCQUFrQixDQUN4QixDQUFDO1FBQ0osQ0FBQyxDQUFDO1FBMVJBLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBRXZCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUV4QyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDbEIsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUVsQixrQkFBTyxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRS9DLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLElBQUksUUFBUSxFQUFFO1lBQ2pDLGtCQUFPLENBQUMsRUFBRSxDQUFDLGlCQUFpQixFQUFFLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxFQUFFO2dCQUMxQyxJQUFJLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ3hCLENBQUMsQ0FBQyxDQUFDO1NBQ0o7YUFBTTtZQUNMLGNBQUcsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1NBQzVDO0lBQ0gsQ0FBQztJQTJMRCxZQUFZO1FBQ1YsSUFBSSxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFO1lBQ25DLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDbkUsY0FBRyxDQUFDLGNBQWMsQ0FDaEIsRUFBRSxJQUFJLEVBQUUsZUFBZSxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsRUFBRSxFQUM5RCxJQUFJLENBQUMsK0JBQStCLENBQ3JDLENBQUM7WUFDRixjQUFHLENBQUMsY0FBYyxDQUNoQixFQUFFLElBQUksRUFBRSxrQkFBa0IsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEVBQUUsRUFDakUsSUFBSSxDQUFDLDRCQUE0QixDQUNsQyxDQUFDO1lBQ0YsY0FBRyxDQUFDLGNBQWMsQ0FDaEIsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsRUFBRSxFQUMzRCxJQUFJLENBQUMsMkJBQTJCLENBQ2pDLENBQUM7WUFDRixJQUFJLENBQUMsTUFBTSxHQUFHLFNBQVMsQ0FBQztTQUN6QjthQUFNLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUN0QixJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLGlCQUFpQixFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBRW5FLElBQUksQ0FBQyxNQUFNLEdBQUcsU0FBUyxDQUFDO1NBQ3pCO0lBQ0gsQ0FBQztJQTJERCxLQUFLO1FBQ0gsY0FBRyxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFDdkQsY0FBRyxDQUFDLGNBQWMsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFFMUQsY0FBRyxDQUFDLGNBQWMsQ0FDaEIsRUFBRSxJQUFJLEVBQUUsa0JBQWtCLEVBQUUsT0FBTyxFQUFFLGNBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxFQUFFLEVBQ2hFLElBQUksQ0FBQyxxQkFBcUIsQ0FDM0IsQ0FBQztRQUNGLGNBQUcsQ0FBQyxjQUFjLENBQ2hCLEVBQUUsSUFBSSxFQUFFLGVBQWUsRUFBRSxPQUFPLEVBQUUsY0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEVBQUUsRUFDN0QsSUFBSSxDQUFDLGtCQUFrQixDQUN4QixDQUFDO1FBQ0YsY0FBRyxDQUFDLGNBQWMsQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFDN0Qsa0RBQWtEO1FBQ2xELGtCQUFPLENBQUMsY0FBYyxDQUFDLGtCQUFrQixFQUFFLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUVqRSxrQkFBTyxDQUFDLGNBQWMsQ0FBQyxlQUFlLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBRTNELGtCQUFPLENBQUMsY0FBYyxDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDekQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUN2QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxVQUFVO1FBQ1IsdUNBQXVDO1FBQ3ZDLGNBQUcsQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRTtZQUM1QixJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDakMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzNCLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsMEJBQTBCLEVBQUU7Z0JBQ3RFLENBQUM7Z0JBQ0QsQ0FBQzthQUNGLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBQ0gsY0FBRyxDQUFDLEVBQUUsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxFQUFFLEVBQUU7WUFDL0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN4QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRDs7T0FFRztJQUNILFVBQVU7UUFDUixrQkFBTyxDQUFDLEVBQUUsQ0FBQyxrQkFBa0IsRUFBRSxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7UUFFckQsa0JBQU8sQ0FBQyxFQUFFLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUUvQyxrQkFBTyxDQUFDLEVBQUUsQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBQy9DLENBQUM7SUFFRCxZQUFZLENBQUMsSUFBUztRQUNwQixJQUFJLFNBQVMsR0FBRztZQUNkLEdBQUcsRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2xCLEdBQUcsRUFBRSxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxHQUFHO1lBQ2hDLElBQUksRUFBRSxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxJQUFJO1NBQ25DLENBQUM7UUFDRixPQUFPLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILFlBQVksQ0FBQyxJQUFVO1FBQ3JCLElBQUksUUFBUSxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNsQyxJQUFJLFdBQVcsR0FBRyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDeEMsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBRTVCLElBQUksU0FBUyxHQUFHO1lBQ2QsUUFBUSxFQUFFO2dCQUNSLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQztnQkFDYixDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUM7Z0JBQ2IsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDO2FBQ2Q7WUFDRCxVQUFVLEVBQUU7Z0JBQ1YsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxDQUFDO2dCQUNoQixDQUFDLEVBQUUsV0FBVyxDQUFDLENBQUM7Z0JBQ2hCLENBQUMsRUFBRSxXQUFXLENBQUMsQ0FBQztnQkFDaEIsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxDQUFDO2FBQ2pCO1lBQ0QsS0FBSyxFQUFFO2dCQUNMLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztnQkFDVixDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7Z0JBQ1YsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO2FBQ1g7U0FDRixDQUFDO1FBQ0YsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVELE9BQU8sS0FBSSxDQUFDO0NBQ2I7QUEvWEQsd0JBK1hDIn0=